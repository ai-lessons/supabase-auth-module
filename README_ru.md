# Supabase Auth Module

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π, –≥–æ—Ç–æ–≤—ã–π –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –º–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Supabase —Å Express.js —Å–µ—Ä–≤–µ—Ä–æ–º, JWT –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ middleware –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê**: –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏ –∏–ª–∏ —Ç–æ–∫–µ–Ω—ã. –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `.env.example` –∫–∞–∫ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª–∏.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è

### 1) –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- **Express.js —Å–µ—Ä–≤–µ—Ä** —Å middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **JWT –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º JWKS (10 –º–∏–Ω—É—Ç)
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π Supabase –∫–ª–∏–µ–Ω—Ç** –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ API –º–∞—Ä—à—Ä—É—Ç—ã**
- **–ö—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —Å CORS –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

### 2) –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

**–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (`server/`):**
- `index.js` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä —Å callback –¥–ª—è Supabase
- `verifyJwt.js` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º JWKS
- `middleware/authMiddleware.js` - –∑–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å Bearer token –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

**–£—Ç–∏–ª–∏—Ç—ã:**
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Supabase –∫–ª–∏–µ–Ω—Ç —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–µ–π –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 3) –ö–ª—é—á–µ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:
- `POST /api/supabase-callback` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- `GET /api/test-protected` - —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
- `GET /api/health` - health check endpoint

### 4) –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **JWKS –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (10 –º–∏–Ω—É—Ç)
- **Bearer token –≤–∞–ª–∏–¥–∞—Ü–∏—è** –≤ middleware
- **–û—Ç–∫–ª—é—á–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è** –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ HTTP —Å—Ç–∞—Ç—É—Å–∞–º–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è issuer –∏ audience** –≤ JWT —Ç–æ–∫–µ–Ω–∞—Ö

### 5) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º:
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** –¥–ª—è –ª—é–±–æ–≥–æ Express.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π** –≤ —Ç–∞–±–ª–∏—Ü—É `wp_user_registrations`
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏** —á–µ—Ä–µ–∑ tracking –ø–æ–ª—è
